name: Terraform GCP

on: 
 push:
  branches:
    - main

permissions:
  contents: read
  id-token: write

jobs:
 terraform:
  runs-on: ubuntu-latest

  steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup terraform
      uses: hashicorp/setup-terraform@v3
    # with:
       #terraform_version: 1.6.6

    - name: Authenticate to Google Cloud
      uses: google-github-actions/auth@v2
      with:
        workload_identity_provider: "projects/344585657590/locations/global/workloadIdentityPools/myassignment/providers/logics" 
        service_account: "second@nifty-oxide-483409-s0.iam.gserviceaccount.com"


    - name: Terraform Init
      run: terraform init

    - name: Terraform Validate
      run: terraform validate

    - name: Terraform Plan
      run: terraform plan

    - name: Terraform Apply
      if: github.ref == 'refs/heads/main' && github.event_name == 'push'
      run: terraform apply -auto-approve
      



      

      
 
